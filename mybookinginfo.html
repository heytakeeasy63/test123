<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èˆªç­æ©Ÿä½ç›£æ§å¤§æ•¸æ“š</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f0f4f8; margin: 0; padding: 20px; }
        .filter-panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .filter-group { display: inline-block; margin-right: 20px; min-width: 200px; vertical-align: top; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #334e68; }
        .flight-card { background: white; margin-bottom: 10px; padding: 15px; border-radius: 8px; border-left: 5px solid #00a650; display: flex; align-items: center; justify-content: space-between; transition: 0.2s; }
        .flight-card:hover { transform: translateX(5px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .no-seat { border-left-color: #ff4b4b; }
        .info-main { flex: 2; }
        .info-seats { flex: 1; text-align: center; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .badge-go { background: #e3f9e5; color: #1db446; }
        .badge-back { background: #e0f2fe; color: #0284c7; }
    </style>
</head>
<body>

<div class="filter-panel">
    <h2>ğŸ” èˆªç­æ¢ä»¶ç¯©é¸</h2>
    <div class="filter-group">
        <label>åœ‹å®¶ / åœ°å€</label>
        <select id="filter-country" class="js-select2" multiple="multiple">
            <option value="æ—¥æœ¬">æ—¥æœ¬ (ğŸ‡¯ğŸ‡µ)</option>
            <option value="éŸ“åœ‹">éŸ“åœ‹ (ğŸ‡°ğŸ‡·)</option>
        </select>
    </div>
    <div class="filter-group">
        <label>æ–¹å‘</label>
        <select id="filter-dir" class="js-select2" multiple="multiple">
            <option value="GO">ğŸ›« å‡ºå¢ƒ (TPE å‡ºç™¼)</option>
            <option value="BACK">ğŸ›¬ å…¥å¢ƒ (å›å°)</option>
        </select>
    </div>
    <div class="filter-group">
        <label>æ©Ÿå ´ (æŠµé”/å‡ºç™¼)</label>
        <select id="filter-airport" class="js-select2" multiple="multiple">
            <option value="NRT">æˆç”° (NRT)</option>
            <option value="HND">ç¾½ç”° (HND)</option>
            <option value="KIX">é—œè¥¿ (KIX)</option>
            <option value="FUK">ç¦å²¡ (FUK)</option>
        </select>
    </div>
</div>

<div id="flight-list">
    </div>

<script>
    let allData = [];

    // åˆå§‹åŒ– Select2
    $(document).ready(function() {
        $('.js-select2').select2({ width: '100%', placeholder: 'å…¨éƒ¨ (ä¸é™)' });
        
        // è®€å– JSON
        fetch('./weekly_flights.json')
            .then(res => res.json())
            .then(data => {
                allData = data;
                renderList(allData);
            });

        // ç›£è½ç¯©é¸è®Šå‹•
        $('.js-select2').on('change', function() {
            const countries = $('#filter-country').val();
            const dirs = $('#filter-dir').val();
            const airports = $('#filter-airport').val();

            const filtered = allData.filter(f => {
                const matchCountry = countries.length === 0 || countries.includes(f.country);
                const matchDir = dirs.length === 0 || dirs.includes(f.direction);
                const matchAirport = airports.length === 0 || airports.some(a => f.route.includes(a));
                return matchCountry && matchDir && matchAirport;
            });
            renderList(filtered);
        });
    });

    function renderList(data) {
        const container = $('#flight-list');
        container.empty();
        
        data.forEach(f => {
            const isFull = f.business === "0" || f.business === "0-";
            const dirBadge = f.direction === 'GO' ? '<span class="badge badge-go">ğŸ›« å‡ºå¢ƒ</span>' : '<span class="badge badge-back">ğŸ›¬ å…¥å¢ƒ</span>';
            
            const html = `
                <div class="flight-card ${isFull ? 'no-seat' : ''}">
                    <div class="info-main">
                        <div style="font-weight: bold; font-size: 1.1em;">${f.flight_no} ${dirBadge}</div>
                        <div style="color: #666; font-size: 0.9em; margin-top: 5px;">ğŸ“… ${f.date} | ğŸ“ ${f.route}</div>
                    </div>
                    <div class="info-seats">
                        <div style="color: ${isFull ? '#ff4b4b' : '#1db446'}; font-weight: bold;">C: ${f.business} / Y: ${f.economy}</div>
                        <div style="font-size: 0.85em; color: #888;">ğŸ‘¥ Pax: ${f.pax}</div>
                    </div>
                </div>
            `;
            container.append(html);
        });
    }
</script>
</body>
</html>
